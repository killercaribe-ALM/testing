<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Grupo para usuarios que pueden ver proveedores -->
    <record id="group_supplier_visibility" model="res.groups">
        <field name="name">Ver Proveedores</field>
        <field name="category_id" ref="base.module_category_hidden"/>
        <field name="comment">Los usuarios en este grupo pueden ver contactos marcados como proveedores</field>
    </record>

    <!-- Asignar el grupo automÃ¡ticamente a usuarios de compras -->
    <record id="purchase.group_purchase_user" model="res.groups">
        <field name="implied_ids" eval="[(4, ref('group_supplier_visibility'))]"/>
    </record>

    <record id="purchase.group_purchase_manager" model="res.groups">
        <field name="implied_ids" eval="[(4, ref('group_supplier_visibility'))]"/>
    </record>

    <!-- Regla: Ocultar proveedores para usuarios sin el grupo -->
    <record id="rule_hide_suppliers" model="ir.rule">
        <field name="name">Ocultar Proveedores</field>
        <field name="model_id" ref="base.model_res_partner"/>
        <field name="domain_force">['|', ('supplier_rank', '=', 0), ('supplier_rank', '=', False)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Regla: Mostrar todos los contactos para usuarios con permisos de ver proveedores -->
    <record id="rule_show_all_partners_for_supplier_viewers" model="ir.rule">
        <field name="name">Ver Todos los Contactos (Incluye Proveedores)</field>
        <field name="model_id" ref="base.model_res_partner"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_supplier_visibility'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Regla adicional para contactos hijos de proveedores -->
    <record id="rule_hide_supplier_children" model="ir.rule">
        <field name="name">Ocultar Contactos de Proveedores</field>
        <field name="model_id" ref="base.model_res_partner"/>
        <field name="domain_force">[
            '|',
            ('parent_id', '=', False),
            '|',
            ('parent_id.supplier_rank', '=', 0),
            ('parent_id.supplier_rank', '=', False)
        ]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>
</odoo>